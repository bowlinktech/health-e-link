/** grace 05132014 05:41AM **/
INSERT INTO `universaltranslator`.`lu_ErrorCodes` (`displayText`, `description`) VALUES ('Invalid Set Up', 'File with same extension, delimiter should be set up either contain headers or do not contain headers.');

/** grace 05132014 04:23PM **/
INSERT INTO `universaltranslator`.`lu_ErrorCodes` (`displayText`) VALUES ('Invalid Delimiter');
UPDATE `universaltranslator`.`lu_ErrorCodes` SET `description`='Delimiter is valid for this type of file' WHERE `id`='15';

/** grace 05142014 11:47 AM **/
CREATE TABLE `universalTranslator`.`rel_TransportRhapsodyDetails` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `transportId` int(11) NOT NULL,
  `directory` varchar(255) DEFAULT NULL,
   PRIMARY KEY (`id`),
  KEY `rhaPransportId_idx` (`transportId`),
  CONSTRAINT `rhaPransportId_idx` FOREIGN KEY (`transportId`) REFERENCES `configurationtransportdetails` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=latin1;


INSERT INTO `universaltranslator`.`ref_transportMethods` (`id`,`transportMethod`, `active`) VALUES (5, 'Rhapsody', 1);

/* Chad 05152014 3:53 PM */
ALTER TABLE `universalTranslator`.`configurationTransportDetails` 
ADD COLUMN `CCDJarTemplate` VARCHAR(45) NULL DEFAULT NULL AFTER `fileExt`;

UPDATE `universalTranslator`.`ref_fileTypes` SET `fileType`='xml (CCD)' WHERE `id`='9';

/** grace 05152014 11:34PM **/
ALTER TABLE `universaltranslator`.`batchuploads` 
ADD COLUMN `originalFolder` VARCHAR(255) NULL AFTER `configId`;
INSERT INTO `universaltranslator`.`lu_ProcessStatus` (`id`,`category`, `displayCode`, `displayText`) VALUES (35, 'batch', 'FR', 'File Reset');

/** Chad 05162014 @ 10:42 PM **/
ALTER TABLE `universalTranslator`.`configurationTransportDetails` 
DROP COLUMN `CCDJarTemplate`;

ALTER TABLE `universalTranslator`.`organizations` 
ADD COLUMN `CCDJarTemplate` VARCHAR(45) NULL DEFAULT NULL AFTER `cleanURL`;

/** Grace 05192014 11:29AM **/
CREATE TABLE `universalTranslator`.`ref_encoding` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `encoding` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=11 DEFAULT CHARSET=latin1;


INSERT INTO `universaltranslator`.`ref_encoding` (`id`, `encoding`) VALUES ('1', 'None');
INSERT INTO `universaltranslator`.`ref_encoding` (`id`, `encoding`) VALUES ('2', 'Base64');

ALTER TABLE `universaltranslator`.`configurationTransportDetails` 
ADD COLUMN `encodingId` INT NULL DEFAULT 1 AFTER `fileExt`,
ADD INDEX `fkEncoding_idx` (`encodingId` ASC);
ALTER TABLE `universaltranslator`.`configurationTransportDetails` 
ADD CONSTRAINT `fkEncoding`
  FOREIGN KEY (`encodingId`)
  REFERENCES `universaltranslator`.`ref_encoding` (`id`)
  ON DELETE NO ACTION
  ON UPDATE NO ACTION;


/** grace 05192014 02:49PM **/
ALTER TABLE `universaltranslator`.`rel_TransportRhapsodyDetails` 
ADD COLUMN `method` INT NULL COMMENT '1 = Push\n2 = Get' AFTER `directory`;

/** grace 05202104 0809AM **/
ALTER TABLE `universaltranslator`.`SFTPJobRunLog` 
RENAME TO  `universaltranslator`.`moveFilesLog` ;

ALTER TABLE `universaltranslator`.`moveFilesLog` 
ADD COLUMN `transportMethodId` INT NOT NULL AFTER `id`;

INSERT INTO `universaltranslator`.`lu_ErrorCodes` (`id`, `displayText`, `description`) VALUES ('16', 'Cannot Determine Encoding Type for File', 'Multiple encodings found for file');
UPDATE `universaltranslator`.`lu_ErrorCodes` SET `description`='Delimiter is invalid for this type of file' WHERE `id`='15';

/** 05202014 Grace 12:08PM **/
ALTER TABLE `universaltranslator`.`batchuploads` 
ADD COLUMN `encodingId` INT NULL COMMENT 'the encoding file came in' AFTER `originalFolder`;


/** 05212014 Grace 11:28 AM**/
ALTER TABLE `universaltranslator`.`macro_names` 
ADD COLUMN `CategoryId` INT NULL DEFAULT 1 COMMENT '1 - data manipulation\n2 - processing' AFTER `ID`;

ALTER TABLE `universaltranslator`.`macro_names` 
DROP COLUMN `Category`;



/** 05212014 Grace 4:28 PM **/

use universalTranslator;
drop procedure if exists getConfigToFromFieldNo;
DELIMITER $$
 
CREATE PROCEDURE getConfigToFromFieldNo (in cInId int, in cOutId int)

proc_main:begin

drop TEMPORARY TABLE if exists fieldAndNos;

CREATE TEMPORARY TABLE fieldAndNos as (select id, cOutId as configIdOut, cInId as configIdIn, 
fieldNo as fieldNoIn, fieldNo as fieldNoOut, saveToTableName, saveToTableCol from configurationFormFields where configId = cOutId order by fieldNoOut);

update fieldAndNos set fieldNoIn = 0;

BEGIN
 
    DECLARE v_finished INTEGER DEFAULT 0;
	DECLARE v_saveToTableName varchar(100) DEFAULT "";
	DECLARE v_saveToTableCol varchar(100) DEFAULT "";
	DECLARE v_fieldNoIn int DEFAULT 0;
	DECLARE v_fieldNoOut int DEFAULT 0;
	DECLARE v_newFieldNo int DEFAULT 0;
	DECLARE v_id int default 0;

 
    -- declare cursor for employee email
    DEClARE fieldNo_cursor CURSOR FOR 
        SELECT id, fieldNoIn, fieldNoOut, saveToTableName, saveToTableCol from fieldAndNos order by fieldNoOut;

    -- declare NOT FOUND handler
    DECLARE CONTINUE HANDLER 
        FOR NOT FOUND SET v_finished = 1;
	
    OPEN fieldNo_cursor;
	
	get_fieldNo: LOOP
		
		
        
		FETCH fieldNo_cursor INTO v_id, v_fieldNoIn, v_fieldNoOut, v_saveToTableName, v_saveToTableCol;
 
        IF v_finished = 1 THEN 
            LEAVE get_fieldNo;
        END IF;
	
	
        -- find fieldNo and update
	if  (v_id > 1) then
		set v_newFieldNo = 0;
		
		select count(fieldNo) into v_newFieldNo from configurationFormFields where configId = cInId 
		and saveToTableName = v_saveToTableName and saveToTableCol = v_saveToTableCol order by fieldNo limit 1;
		
		if (v_newFieldNo > 0) then
			select fieldNo into v_newFieldNo from configurationFormFields where configId = cInId 
			and saveToTableName = v_saveToTableName and saveToTableCol = v_saveToTableCol order by fieldNo limit 1;
			update fieldAndNos set fieldNoIn = v_newFieldNo where id = v_id;
		end if; 
		
		
		
	end if;
	
    END LOOP get_fieldNo;
 
    CLOSE fieldNo_cursor;

	
END;

select * from fieldAndNos order by fieldNoOut;
end proc_main$$
 
DELIMITER ;



/** 05212014 Chad 3:47 PM **/
ALTER TABLE `universalTranslator`.`message_Encounters` 
DROP COLUMN `status`,
DROP COLUMN `encounterDate`,
CHANGE COLUMN `encounter` `ICD9Code` VARCHAR(45) NULL DEFAULT NULL ,
CHANGE COLUMN `performer` `description` VARCHAR(500) NULL DEFAULT NULL ;

/** 05222014 Chad @ 12:03 PM **/
CREATE TABLE `universalTranslator`.`configurationPreProcessing` (
  `id` INT UNSIGNED NOT NULL,
  `configId` INT NOT NULL,
  `macroId` INT NOT NULL,
  `fieldA` VARCHAR(45) NULL,
  `fieldB` VARCHAR(45) NULL,
  `constant1` VARCHAR(45) NULL,
  `constant2` VARCHAR(45) NULL,
  `processOrder` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `cppConfigId_idx` (`configId` ASC),
  INDEX `ccpMacroId_idx` (`macroId` ASC),
  CONSTRAINT `cppConfigId`
    FOREIGN KEY (`configId`)
    REFERENCES `universalTranslator`.`configurations` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `ccpMacroId`
    FOREIGN KEY (`macroId`)
    REFERENCES `universalTranslator`.`macro_names` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

CREATE TABLE `universalTranslator`.`configurationPostProcessing` (
  `id` INT UNSIGNED NOT NULL,
  `configId` INT NOT NULL,
  `macroId` INT NOT NULL,
  `fieldA` VARCHAR(45) NULL,
  `fieldB` VARCHAR(45) NULL,
  `constant1` VARCHAR(45) NULL,
  `constant2` VARCHAR(45) NULL,
  `processOrder` INT NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `cpstpConfigId_idx` (`configId` ASC),
  INDEX `cpstpMacroId_idx` (`macroId` ASC),
  CONSTRAINT `cpstpConfigId`
    FOREIGN KEY (`configId`)
    REFERENCES `universalTranslator`.`configurations` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `cpstpMacroId`
    FOREIGN KEY (`macroId`)
    REFERENCES `universalTranslator`.`macro_names` (`ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION);

/** grace 05222014 10:49PM **/
INSERT INTO `universaltranslator`.`lu_errorcodes` (`id`, `displayText`, `description`, `isCustom`, `status`) VALUES ('17', 'File Did Not Decode Correctly', 'System was not able to decode file', 0, 1);


/** grace 05272014 AM**/
ALTER TABLE `universaltranslator`.`configurationdatatranslations` 
ADD COLUMN `categoryId` INT NULL DEFAULT 3 COMMENT '1. pre-processing\n2. post processing\n3. while processing' AFTER `processOrder`;


/** grace 05272014 1:27 PM **/
use universalTranslator;
drop procedure if exists processFieldListAsSingleValues;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `processFieldListAsSingleValues`(in configId int, 
in batchId int, in srcField varchar(10),
in fieldA varchar(10), in fieldB varchar(10), in con1 varchar(10), 
in con2 varchar(10), in macroId int, in foroutboundProcessing boolean, in passClear int, in transactionId int)
proc_main:begin
-- this sets out table
call setInboundOutBoundTables (foroutboundProcessing);
select @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable
into @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable;

call getFinalStatusIds;
select @finalStatusIds into @finalStatusIds;


-- build our sql
if (transactionId = 0) then
	set @stmt = concat("update ",@translatedTable, " set ",fieldA," = replace(",fieldA,", '",con1,"','^^^^^') where ",@transactionTable,"Id in (select id from ",@transactionTable,
				" where configId = ",configId," and ", @batchIdType," = ",batchId," and statusId not in (",@finalStatusIds ,"));");
	END if;


if (transactionId != 0) then
	set @stmt = concat("update ",@translatedTable, " set ",fieldA," = replace(",fieldA,", '",con1,"','^^^^^') where ",
	@transactionTable,"Id = ", transactionId,";");
	END if;

PREPARE stmt from @stmt;
EXECUTE stmt;-- execute

-- we check pass /clear
if (passClear = 2) THEN
BEGIN
-- accessible
END;
END IF;


-- the only error for this is if SP bombs, no need to write in insert error logs
select '';
end proc_main$$
DELIMITER ;

/** Chad 05272014 @ 9:33 AM **/
CREATE TABLE `HL7Specs` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `Name` varchar(45) NOT NULL,
  `fieldSeparator` varchar(1) NOT NULL DEFAULT '|',
  `componentSeparator` varchar(1) NOT NULL DEFAULT '^',
  `EscapeChar` varchar(45) NOT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=latin1;

CREATE TABLE `HL7Segments` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `hl7Id` int(11) NOT NULL,
  `segmentName` varchar(3) NOT NULL,
  `displayPos` int(11) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `mainsegHL7Idfk_idx` (`hl7Id`),
  CONSTRAINT `mainsegHL7Idfk` FOREIGN KEY (`hl7Id`) REFERENCES `HL7Specs` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=latin1;

CREATE TABLE `HL7Elements` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `hl7Id` int(11) NOT NULL,
  `segmentId` int(11) NOT NULL,
  `elementName` varchar(255) NOT NULL,
  `displayPos` int(11) NOT NULL DEFAULT '1',
  `defaultValue` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `mainelemHLyIdfk_idx` (`hl7Id`),
  KEY `mainelemSegIdfk_idx` (`segmentId`),
  CONSTRAINT `mainelemHLyIdfk` FOREIGN KEY (`hl7Id`) REFERENCES `HL7Specs` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION,
  CONSTRAINT `mainelemSegIdfk` FOREIGN KEY (`segmentId`) REFERENCES `HL7Segments` (`id`) ON DELETE NO ACTION ON UPDATE NO ACTION
) ENGINE=InnoDB AUTO_INCREMENT=131 DEFAULT CHARSET=latin1;


/** grace 05282014 11:49PM **/
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('1', 'Pelvic Exam', 'Pelvic Exam');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('2', 'Breast Exam', 'Breast Exam');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('3', 'Implant Insert', 'Implant Insert');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('4', 'Implant Removal', 'Implant Removal');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('5', 'Implant Replacement', 'Implant Replacement');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('6', 'HPV', 'HPV');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('7', 'Other', 'Other');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('8', 'Emergency Contraception', 'Emergency Contraception');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('9', 'CBE Referral', 'CBE Referral');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('10', 'Wart Treatment', 'Wart Treatment');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('11', 'Vasectomy', 'Vasectomy');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('12', 'Wart Treatment', 'Wart Treatment');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('13', 'Diaphragm / Cap Fitting', 'Diaphragm / Cap Fitting');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('14', 'Colposcopy', 'Colposcopy');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('15', 'Colposcopy w/ Biopsy', 'Colposcopy w/ Biopsy');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('16', 'Colposcopy w/ Leep', 'Colposcopy w/ Leep');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('17', 'Cryo Cautery', 'Cryo Cautery');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('18', 'Colposcopy w/ Leep', 'Colposcopy w/ Leep');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('19', 'IUD Insertion', 'IUD Insertion');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('20', 'IUD Removal', 'IUD Removal');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('21', 'Tubal Ligation', 'Tubal Ligation');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('22', 'HIV Test - Standard', 'HIV Test - Standard');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('23', 'HIV Test - Standard Result Provided', 'HIV Test - Standard Result Provided');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('24', 'Pregnancy Test', 'Pregnancy Test');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('25', 'Cholesterol', 'Cholesterol');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('26', 'Anemia Screening', 'Anemia Screening');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('27', 'RPR', 'RPR');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('28', 'HIV Test - Rapid', 'HIV Test - Rapid');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('29', 'HEP C Test', 'HEP C Test');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('30', 'Wet Prep  / Mount', 'Wet Prep  / Mount');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('31', 'Chlamydia Test', 'Chlamydia Test');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('32', 'GC', 'GC');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('33', 'Pap Smear', 'Pap Smear');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('34', 'Pap Smear', 'Pap Smear');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('35', 'Pap Smear', 'Pap Smear');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('36', 'Pap Smear', 'Pap Smear');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('37', 'Injection contraception', 'Injection contraception');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('38', 'Limited/ Minor', 'Limited/ Minor');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('39', 'Low to Moderate', 'Low to Moderate');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('40', 'Moderate', 'Moderate');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('41', 'Moderate to High', 'Moderate to High');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('42', 'High Complexity', 'High Complexity');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('43', 'Brief', 'Brief');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('44', 'Minor Complexity', 'Minor Complexity');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('45', 'Low Complexity', 'Low Complexity');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('46', 'Moderate to High', 'Moderate to High');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('47', 'High Complexity', 'High Complexity');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('48', 'Age 12- 17 Years', 'Age 12- 17 Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('49', 'Age 18-39 Years', 'Age 18-39 Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('50', 'Age 40-64 Years', 'Age 40-64 Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('51', 'Age 65+ Years', 'Age 65+ Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('52', 'Age 12- 17 Years', 'Age 12- 17 Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('53', 'Age 18-39 Years', 'Age 18-39 Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('54', 'Age 40-64 Years', 'Age 40-64 Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('55', 'Age 65+ Years', 'Age 65+ Years');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('56', 'Short', 'Short');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('57', 'Long', 'Long');
INSERT INTO `universaltranslator`.`lu_tests` (`id`, `displayText`, `description`) VALUES ('58', 'Injection Contraception', 'Injection Contraception');

/** grace 05282014 12:20 PM **/
ALTER TABLE `universaltranslator`.`message_visitinfo` 
ADD COLUMN `subRecipientId` INT NULL AFTER `bmi`;

ALTER TABLE `universaltranslator`.`message_races` 
ADD COLUMN `refusedToState` INT NULL AFTER `moreThanOneRace`;

ALTER TABLE `universaltranslator`.`message_visitinfo` 
ADD COLUMN `incomeUnit` VARCHAR(45) NULL AFTER `wklyIncome`;

ALTER TABLE `universaltranslator`.`message_visitinfo` 
ADD COLUMN `weightUnitReported` VARCHAR(45) NULL AFTER `weight`,
ADD COLUMN `heightUnitReported` VARCHAR(45) NULL AFTER `height`;

ALTER TABLE `universaltranslator`.`message_Patients` 
ADD COLUMN `initialNoContraceptiveId` INT NULL AFTER `initialContraceptiveId`;

ALTER TABLE `universaltranslator`.`message_visitinfo` 
ADD COLUMN `pregIntentions` VARCHAR(45) NULL AFTER `subRecipientId`;

ALTER TABLE `universaltranslator`.`message_visitinfo` 
ADD COLUMN `pregHistory` INT NULL AFTER `pregIntentions`;


/** grace 05282014 09:54PM   -  All ABOVE UPDATES are on DEV and TEST **/
/** Chad 05292014 @ 11:35 PM **/
UPDATE `universalTranslator`.`lu_Races` SET `displayText`='American Indian/Alaskan Native' WHERE `id`='3';
UPDATE `universalTranslator`.`lu_Races` SET `displayText`='Black or African American' WHERE `id`='2';
UPDATE `universalTranslator`.`lu_Races` SET `displayText`='Native Hawaiian or Other Pacific Islander' WHERE `id`='5';
INSERT INTO `universalTranslator`.`lu_Races` (`displayText`, `isCustom`, `status`) VALUES ('More than One Race', 0, 1);
UPDATE `universalTranslator`.`lu_Races` SET `displayText`='Unknown or Refused to Report' WHERE `id`='6';

UPDATE `universalTranslator`.`lu_Genders` SET `displayText`='Unknown or Refused to Report' WHERE `id`='4';

UPDATE `universalTranslator`.`lu_Hispanics` SET `displayText`='Hispanic or Latino' WHERE `id`='1';
UPDATE `universalTranslator`.`lu_Hispanics` SET `displayText`='Not Hispanic or Latino' WHERE `id`='2';
UPDATE `universalTranslator`.`lu_Hispanics` SET `displayText`='Unknown or Refused to Report' WHERE `id`='3';


/** grace 05292014 3:23PM **/
update organizations set orgName = 'Universal Transaltor' where id = 1;



/** grace 05302014 12:38AM **/
use universalTranslator;
drop procedure if exists concatFieldToList ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `concatFieldToList`(in configId int, 
in batchId int, in srcField varchar(10),
in fieldA varchar(10), in fieldB varchar(10), in con1 varchar(255), 
in con2 varchar(255), in macroId int, in foroutboundProcessing boolean, in passClear int, in transactionId int)
proc_main:begin

-- sample usage CALL `universaltranslator`.`concatFieldToList`(34, 8, 'F255', 'F255', '0', '^^^^^', '3,4,5,6,8,1', 35,false, 2, 0);
/**
this procedure concats fields in Con2  with delimiter con1 and replaces fieldNo in fieldA
**/


call setInboundOutBoundTables (foroutboundProcessing);
select @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable
into @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable;

call getFinalStatusIds;
select @finalStatusIds into @finalStatusIds;

set @fields = concat('F', replace(replace(con2, ' ', ''), ',', ',F'));
set @sql = concat("concat_ws('",con1,"', " , @fields , ")");

if (transactionId = 0) then
	BEGIN
		set @stmt = concat("update " ,@translatedTable,  " set ", srcField, " = ", @sql , 
		" where " , @transactionTable, "Id in (select id from ", 
		@transactionTable, " where configId = ", configId, " and ", @batchIdType, " = ",batchId, 
		" and statusId not in (", @finalStatusIds, "));");
	end;
end if;


if (transactionId != 0) then
	BEGIN
		set @stmt = concat("update ",@translatedTable, " set ", srcField," = ", @sql , " where ", @transactionTable,"Id = ", transactionId, ";");
	end;
end if;
/** **/
PREPARE stmt from @stmt;
EXECUTE stmt;-- execute

select '';

end proc_main$$
DELIMITER ;

INSERT INTO `universaltranslator`.`macro_names` (`CategoryId`, `Macro_Name`, `Macro_Short_Name`, `Formula`, `FieldA_Question`, `Con1_Question`, `Con2_Question`, `populateFieldA`) VALUES ('1', 'Concat fields into delimited list', 'concatFieldToList', 'concatFieldToList', 'Please enter field to store list', 'Pleaes enter delimiter', 'Please enter field number in a comma delimited list', 1);

/** all above updates are applied on DPH  grace 05302014 12:53AM **/

/** grace 06012014 04:56 AM **/
use universalTranslator;

drop procedure if exists stripCharAtPos;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `stripCharAtPos`(in configId int, 
in batchId int, in srcField varchar(10), in fieldA varchar(10), in fieldB varchar(10), in con1 varchar(10), 
in con2 varchar(10), in macroId int, in foroutboundProcessing boolean, in passClear int, in transactionId int)

proc_main:begin
-- sample usage CALL `universaltranslator`.`stripCharAtPos`(34, 12, 'F3', 'F255', 'F', '4', '', 9875, false, 2, 0);

-- this sets out table
call setInboundOutBoundTables (foroutboundProcessing);
select @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable
into @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable;

call getFinalStatusIds;
select @finalStatusIds into @finalStatusIds;

-- fieldA - field to update, fieldA already has false
-- fieldB - field to read value from
-- conA  field position
-- conB field to match, leave blank if just dropping

set @readField = fieldA;
set @strCompare = '';

select fieldB;
if (fieldB != 'F') then
	begin 
		set @readField = fieldB;
end;
end if; 

if (length(trim(con2)) != 0) then
	begin 
		set @strCompare = concat(" and substring(", @readField, ",", con1, ", 1) = '", con2, "'");
	end;
end if; 

-- build our sql
if (transactionId = 0) then
begin

select @readField;

set @stmt = concat("update ",@translatedTable, " set ",fieldA," = concat(substring(", @readField,", 1, (", con1, "-1)), 
substring(", @readField, ", (", con1, " + 1),length(", @readField,")- ", con1,")) where length(", @readField,") >= " ,con1 , 
@strCompare, "  and ",@transactionTable,"Id in (select id from ",@transactionTable,
" where configId = ",configId," and ", @batchIdType," = ",batchId," and statusId not in (",@finalStatusIds ,"));");

end;
END if;


if (transactionId != 0) then

	set @stmt = concat("update ",@translatedTable, " set ",fieldA," = concat(substring(", @readField,", 1, (", con1, "-1)), 
	substring(", @readField, ", (", con1, " + 1),length(", @readField,")- ", con1,")) where length(", @readField,") >= " ,con1 , 
	@strCompare, "  and ",@transactionTable,"Id =", transactionId,";");
END if;

-- insert into formula (formula) values (@stmt);

 PREPARE stmt from @stmt;
 EXECUTE stmt;-- execute

-- we check pass /clear
if (passClear = 2) THEN
BEGIN
-- accessible
END;
END IF;


-- the only error for this is if SP bombs, no need to write in insert error logs
select '';
end proc_main$$
DELIMITER ;

INSERT INTO `universaltranslator`.`Macro_Names` (`Macro_Name`, `Macro_Short_Name`, `Formula`, `FieldA_Question`, `FieldB_Question`, `Con1_Question`, `Con2_Question`, `populateFieldA`) VALUES ('Strip character at specific position of field, can update another column and have option match', 'stripCharAtPos', 'stripCharAtPos', 'Please enter field to update', 'Please enter field to strip value from', 'Please enter position of character to drop', 'Please enter character to drop (optional)', 1);


/** all above updates are applied on DPH  grace 06012014 05:09AM **/


/** grace 06.02.2014 2:11 PM **/
use universalTranslator;

drop procedure if exists replaceNullWithChars ;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `replaceNullWithChars`(in configId int, 
in batchId int, in srcField varchar(10),
in fieldA varchar(10), in fieldB varchar(10), in con1 varchar(10), 
in con2 varchar(10), in macroId int, in foroutboundProcessing boolean, in passClear int, in transactionId int)
proc_main:begin

-- this SP matches null for fieldA and will replace it with con1
-- FieldA - Field you would like to replace
-- FieldB - field you would like to check against
-- Con1 - what value would you like to replace null with

set @fieldToReplace = fieldA;
if (fieldB != 'F') then
	set @fieldToReplace = fieldB;
end if;

-- this sets out table
call setInboundOutBoundTables (foroutboundProcessing);
select @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable
into @translatedTable, @transactionTable, @batchTable, @batchIdType , @errorTable;

call getFinalStatusIds;
select @finalStatusIds into @finalStatusIds;


-- build our sql
if (transactionId = 0) then
	set @stmt = concat("update ",@translatedTable, " set ",fieldA," = '" ,con1,  "' where ",@fieldToReplace, " is null and ",
	@transactionTable,"Id in (select id from ",@transactionTable,
				" where configId = ",configId," and ", @batchIdType," = ",batchId," and statusId not in (",@finalStatusIds ,"));");
	END if;


if (transactionId != 0) then
	set @stmt = concat("update ",@translatedTable, " set ",fieldA," = '",con1, "' where ", @fieldToReplace , " is null and " ,
	@transactionTable,"Id = ", transactionId,";");
	END if;

	PREPARE stmt from @stmt;
	EXECUTE stmt;-- execute

-- we check pass /clear
if (passClear = 2) THEN
BEGIN
-- accessible
END;
END IF;


-- the only error for this is if SP bombs, no need to write in insert error logs
select '';
end proc_main$$
DELIMITER ;


INSERT INTO `universaltranslator`.`macro_names` (`Macro_Name`, `Macro_Short_Name`, `Formula`, `FieldA_Question`, `FieldB_Question`, `Con1_Question`, `populateFieldA`) VALUES ('Match Null value and replace', 'replaceNullWithChars', 'replaceNullWithChars', 'Please enter field that you would like to replace', 'Please enter field to match if null value is in another column (optional)', 'Please enter value that you would like to replace null with', 1);

/** grace 06022014 09:19PM **/

delete from `universaltranslator`.`lu_tests`;

ALTER TABLE `universaltranslator`.`lu_tests` 
ADD COLUMN `category` VARCHAR(5) NULL COMMENT 'cv\rms\rproc\rpv\rvt' AFTER `vitalSign`;


INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (1,'vt','Limited / Minor','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (2,'vt','Low to Moderate','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (3,'vt','Moderate','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (4,'vt','Moderate to High','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (5,'vt','High Complexity','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (6,'vt','Brief','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (7,'vt','Minor Complexity','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (8,'vt','Low Complexity','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (9,'vt','Moderate to High','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (10,'vt','High Complexity','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (11,'pv','Age 12-17 Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (12,'pv','Age 18-39 Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (13,'pv','Age 40-64 Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (14,'pv','Age 65+ Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (15,'pv','Age 12-17 Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (16,'pv','Age 18-39 Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (17,'pv','Age 40-64 Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (18,'pv','Age 65+ Years','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (19,'cv','Short','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (20,'cv','Long','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (21,'proc','Colposcopy','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (22,'proc','Colposcopy w/ Biopsy','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (23,'proc','Colposcopy w/ Leep','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (24,'proc','Cryo Cautery','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (25,'proc','IUD Insertion','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (26,'proc','IUD Removal','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (27,'proc','Implant Insert','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (28,'proc','Implant Removal','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (29,'proc','Implant Replacement','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (30,'proc','Female Sterilization','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (31,'proc','Vasectomy','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (32,'ms','Pap Smear','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (33,'ms','Breast Exam','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (34,'ms','Blood Pressure','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (35,'ms','Pelvic Exam','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (36,'ms','Pregnancy Test','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (37,'ms','Pregnancy Test - Positive','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (38,'ms','Pregnancy Test - Negative','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (39,'ms','Urinalysis','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (40,'ms','Anemia Screening','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (41,'ms','HIV Test','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (42,'ms','HEP B Test','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (43,'ms','HEP B Shot (11-19 Yrs)','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (44,'ms','HEP B Shot (20+ Yrs)','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (45,'ms','HEP C Test','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (46,'ms','Cholesterol','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (47,'ms','RPR','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (48,'ms','Chlamydia Test','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (49,'ms','GC','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (51,'ms','HSV Culture','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (52,'ms','Wet Prep / Mount','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (53,'proc','Wart Treatment','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (54,'ms','Emergency Contraception','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (55,'ms','Infertility Work Up','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (56,'proc','Diaphragm / Cap Fitting','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (57,'ms','Injectible Contraception','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (58,'ms','GU Exam - Male','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (59,'ms','Rectal Exam','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (60,'ms','Other','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (61,'ms','Testicular Exam','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (62,'proc','Injection Contraception','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (63,'proc','Venipuncture','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (64,'ms','CBE Referral','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (65,'ms','HPV Test','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (71,'ms','HIV Test - Standard','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (72,'ms','HIV Test - Rapid','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (73,'ms','HIV Standard Test - Result Provided','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (100,'ms','Blood Type & RH','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (101,'ms','CBC','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (102,'ms','Glucose','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (103,'ms','Herpes Culture','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (104,'ms','Herpes serum antibody','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (105,'ms','Lipid Panel','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (106,'ms','Rubella Antibody','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (107,'ms','Pap Smear - thin prep','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (108,'ms','Thyroid Stimulating','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (109,'ms','Urine Culture','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (110,'ms','Urine Sensivities','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (111,'ms','HEP B Vaccine','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (112,'ms','Hemoglobin / Hematocrit','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (113,'ms','Azithromycin 250mg','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (114,'ms','Azithromycin 1g','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (115,'ms','Doxycycline','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (116,'ms','Fluconazole','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (117,'ms','Metronidazole 250mg','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (118,'ms','Metronidazole 500mg','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (119,'ms','Metrogel vaginal','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (120,'ms','Prenatal vitamins','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (121,'ms','HCG qualitative serum','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (122,'ms','HCG quantitative serum','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (123,'ms','DPH Urine screen','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (124,'ms','DPH Syphilis screen','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (125,'ms','DPH Hepatitis screen','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (126,'ms','DPH HIV','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');
INSERT INTO `lu_tests` (`id`,`category`,`displayText`,`vitalSign`,`description`,`normalRange`,`normalRangeUnit`,`codeSystem`,`codeValue`,`codeVersion`,`isCustom`,`status`,`dateCreated`) VALUES (127,'ms','HPV Vaccination','0',NULL,NULL,NULL,NULL,NULL,NULL,'0','1','2014-06-02 21:40:04');

/** grace 06032014 12:42 PM **/
use universalTranslator;
drop procedure if exists insertValidationErrors;

DELIMITER $$
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertValidationErrors`(in vtType int, in fieldNo int,
in batchUploadId int, in configId int, in transactionId int)
BEGIN

DECLARE regEx varchar(100) DEFAULT '';

CASE vtType
	WHEN 2 THEN set regEx = '^[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$';
    WHEN 3 THEN 
		BEGIN 
			CALL `universalTranslator`.`stripPhoneChars`(vtType, fieldNo, batchUploadId, configId, transactionId);
			set regEx ='^[0-9]{7,11}$';
		END;
	WHEN 5 THEN set regEx = '^-?[0-9]+[.]?[0-9]*$|^-?[.][0-9]+$';
    ELSE
        BEGIN
        END;
	END 
	CASE;

IF (transactionId = 0) THEN
set @stmt = concat(
'insert into transactionInerrors (batchUploadId, transactionInId, fieldNo, errorid, configId,
validationTypeId) SELECT ', batchUploadId, ', transactionInId, ',fieldNo,',2, ',configId, ',' , vtType,'  
 FROM transactionTranslatedIn WHERE trim(F' ,fieldNo, ') not REGEXP  "', regEx, '" and F',fieldNo, ' is not null 
and length(F', fieldNO, ') != 0
and length(trim(F', fieldNO, ')) != 0
and length(REPLACE(REPLACE(F', fieldNO,' , "\n", ""), "\r", "") != 0) and configId = ', configId, ' and transactionInId 
in (select id from transactionIn where batchId = ', batchUploadId,' and configId = ', configId,' and statusId not in (11,12,13,16));'
);

BEGIN -- true
		PREPARE stmt from @stmt;
		EXECUTE stmt;
END; 
END IF;

IF (transactionId != 0) THEN

set @stmt= concat(
'insert into transactionInerrors (batchUploadId, transactionInId, fieldNo, errorid, configId, 
validationTypeId) SELECT ', batchUploadId, ', transactionInId, ',fieldNo,',2, ', configId, ',', vtType,'  
 FROM transactionTranslatedIn WHERE trim(F' ,fieldNo, ') not REGEXP  "', regEx, '" and F',fieldNo, ' is not null 
and length(F', fieldNO, ') != 0
and length(trim(F', fieldNO, ')) != 0
and length(REPLACE(REPLACE(F', fieldNO,', "\n", ""), "\r", "") != 0) and configId = ', configId, ' and transactionInId 
in (select id from transactionIn where id = ', transactionId, ');'
);

BEGIN -- true
		PREPARE stmt from @stmt;
		EXECUTE stmt;


END; 
END IF;


END$$
DELIMITER ;


/** grace 01:28PM 06032014 **/
INSERT INTO `lu_noContraceptiveReasons` (`id`,`displayText`,`description`,`isCustom`,`status`,`dateCreated`) VALUES (5,'Unknown','','0','1','2014-06-03 13:24:55');
INSERT INTO `universaltranslator`.`lu_payertypes` (`id`, `displayText`) VALUES ('18', 'Unknown');

/** grace 06032014 10:44PM **/
INSERT INTO `universaltranslator`.`lu_processstatus` (`id`, `category`, `displayCode`) VALUES ('36', 'batch', 'LWT');
UPDATE `universaltranslator`.`lu_processstatus` SET `displayCode`='SSL', `displayText`='Source Submission Reloaded' WHERE `id`='36';
UPDATE `universaltranslator`.`lu_processstatus` SET `displayCode`='SSR', `displayText`='Source Submission Reloaded' WHERE `id`='3';


